{"version":3,"file":"static/webpack/static/development/pages/user/update.js.d1886ca485f225c6b160.hot-update.js","sources":["webpack:///./actions/auth.js","webpack:///./components/auth/ProfileUpdate.js"],"sourcesContent":["import fetch from 'isomorphic-fetch';\nimport {API} from '../config';\nimport cookie from 'js-cookie';\nimport { get } from 'mongoose';\nexport const signup=(user)=>{\n   \n    return fetch(`${API}/api/auth/signup`,{\n        method:'POST',\n        headers:{\n            Accept:'application/json',\n            'Content-type':'application/json'\n        },\n        body:JSON.stringify(user)\n\n    })\n    .then(response=>response.json())\n    .catch(err=>console.log(err))\n};\nexport const updateUser = (user, next) => {\n    if (process.browser) {\n        if (localStorage.getItem('user')) {\n            let auth = JSON.parse(localStorage.getItem('user'));\n            auth = user;\n            localStorage.setItem('user', JSON.stringify(auth));\n            next();\n        }\n    }\n};\nexport const signin=(user)=>{\n   \n    return fetch(`${API}/api/auth/signin`,{\n        method:'POST',\n        headers:{\n            Accept:'application/json',\n            'Content-type':'application/json'\n        },\n        body:JSON.stringify(user)\n\n    })\n \n    .then(response=>response.json())\n    .catch(err=>console.log(err))\n};\n\nexport const setCookie=(key,value)=>{\n    if(process.browser){\n\n        cookie.set(key,value,{expires:1})\n    }\n};\n\nexport const removeCookie=(key)=>{\n    if(process.browser){\n\n        cookie.remove(key,{expires:1})\n    }\n};\nexport const getCookie=(key)=>{\n    if(process.browser){\n\n     return   cookie.get(key)\n    }\n};\n\nexport const setLocalStorage=(key,value)=>{\n    if(process.browser){\n        localStorage.setItem(key,JSON.stringify(value))\n    }\n};\n\n\nexport const removeLocalStorage=(key)=>{\n    if(process.browser){\n        localStorage.removeItem(key)\n    }\n};\n\nexport const authentication=(data,next)=>{\n   console.log(data.user) \n   setCookie('token',data.token);\n   setLocalStorage('user',data.user);\n   next();\n};\n\nexport const signout=(next)=>{\nremoveCookie('token');\nremoveLocalStorage('user');\nnext()\nreturn fetch(`${API}/api/auth/signout`,{\n    method:\"GET\",\n\n})\n.then(res=>{console.log(\"signout success\")})\n.catch(err=>console.log(err))\n}\n\nexport const isAuth=(key)=>{\n    if(process.browser){\n      const cookieChecked=getCookie('token');\n      if(cookieChecked){\n          if(localStorage.getItem('user')){\n              return JSON.parse(localStorage.getItem('user'))\n          }\n          else{\n              return false;\n          }\n      }\n    }\n}","import Link from 'next/link';\nimport { useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport { getCookie, isAuth,updateUser } from '../../actions/auth';\nimport { getProfile, update } from '../../actions/user';\nimport { API } from '../../config';\n \nconst ProfileUpdate = () => {\n    const [values, setValues] = useState({\n        username: '',\n        username_for_photo: '',\n        name: '',\n        email: '',\n        about: '',\n        password: '',\n        error: false,\n        success: false,\n        loading: false,\n        photo: '',\n        userData: process.browser && new FormData()\n    });\n \n    const token = getCookie('token');\n    const {\n        username,\n        username_for_photo,\n        name,\n        email,\n        about,\n        password,\n        error,\n        success,\n        loading,\n        photo,\n        userData\n    } = values;\n \n    const init = () => {\n        getProfile(token).then(data => {\n            if (data.error) {\n                setValues({ ...values, error: data.error });\n            } else {\n                setValues({\n                    ...values,\n                    username: data.username,\n                    username_for_photo: data.username,\n                    name: data.name,\n                    email: data.email,\n                    about: data.about\n                });\n            }\n        });\n    };\n \n    useEffect(() => {\n        init();\n        setValues({ ...values, userData: new FormData() });\n    }, []);\n \n    const handleChange = name => e => {\n        // console.log(e.target.value);\n        const value = name === 'photo' ? e.target.files[0] : e.target.value;\n        // let userData = new FormData();\n        userData.set(name, value);\n        console.log(...userData); // SEE THE FORMDATA IN CONSOLE\n        setValues({ ...values, [name]: value, userData, error: false, success: false });\n    };\n \n    const handleSubmit = e => {\n        e.preventDefault();\n \n        setValues({ ...values, loading: true });\n        update(token, userData).then(data => {\n            if (data.error) {\n                console.log('data.error', data.error);\n                setValues({ ...values, error: data.error, loading: false });\n            } else {\n                updateUser(data, () => {\n                    setValues({\n                        ...values,\n                        username: data.username,\n                        name: data.name,\n                        email: data.email,\n                        about: data.about,\n                        password: '',\n                        success: true,\n                        loading: false\n                    });\n                });\n            }\n        });\n    };\n \n    const profileUpdateForm = () => (\n        <form onSubmit={handleSubmit}>\n            <div className=\"form-group\">\n                <label className=\"btn btn-outline-info\">\n                    Profile photo\n                    <input onChange={handleChange('photo')} type=\"file\" accept=\"image/*\" hidden />\n                </label>\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">Username</label>\n                <input onChange={handleChange('username')} type=\"text\" value={username} className=\"form-control\" />\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">Name</label>\n                <input onChange={handleChange('name')} type=\"text\" value={name} className=\"form-control\" />\n            </div>\n            {/*<div className=\"form-group\">\n                <label className=\"text-muted\">Email</label>\n                <input onChange={handleChange('email')} type=\"text\" value={email} className=\"form-control\" />\n            </div>*/}\n            <div className=\"form-group\">\n                <label className=\"text-muted\">About</label>\n                <textarea onChange={handleChange('about')} type=\"text\" value={about} className=\"form-control\" />\n            </div>\n            <div className=\"form-group\">\n                <label className=\"text-muted\">Password</label>\n                <input onChange={handleChange('password')} type=\"password\" value={password} className=\"form-control\" />\n            </div>\n            <div>\n                {/* {showSuccess()}\n                {showError()}\n                {showLoading()} */}\n            </div>\n            <div>\n                <button type=\"submit\" className=\"btn btn-primary\" disabled={!username || !name || !email}>\n                    Update\n                </button>\n            </div>\n        </form>\n    );\n \n    const showError = () => (\n        <div className=\"alert alert-danger\" >\n            {error}\n        </div>\n    );\n \n    const showSuccess = () => (\n        <div className=\"alert alert-success\" >\n            Profile updated\n        </div>\n    );\n \n    const showLoading = () => (\n        <div className=\"alert alert-info\" >\n            Loading...\n        </div>\n    );\n \n    return (\n        <React.Fragment>\n            <div className=\"container\">\n                <div className=\"row\">\n                    <div className=\"col-md-4\">\n                        <img\n                            src={`${API}/api/user/photo/${username_for_photo}`}\n                            className=\"img img-fluid img-thumbnail mb-3\"\n                          \n                            alt=\"user profile\"\n                        />\n                    </div>\n                    <div className=\"col-md-8 mb-5\">{profileUpdateForm()}</div>\n                </div>\n            </div>\n        </React.Fragment>\n    );\n};\n \nexport default ProfileUpdate;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AANA;AASA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AANA;AAUA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AADA;AAAA;AACA;AAcA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA6BA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AAPA;AACA;AAQA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAlCA;AACA;AAwCA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAKA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;;;;A","sourceRoot":""}